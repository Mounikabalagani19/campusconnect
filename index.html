<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CampusFix - Issue Reporting Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&display=swap');
        
        :root {
            --bg-image: url('https://images.unsplash.com/photo-1541339907198-e08756ebafe3?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.2)), url(college.webp);
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            min-height: 100vh;
        }

        #login-screen {
            background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url(college.webp);
            background-size: cover;
            background-position: center;
        }

        .login-wrapper {
            width: 420px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, .2);
            backdrop-filter: blur(25px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            color: #fff;
            border-radius: 24px;
            padding: 40px;
        }

        .login-wrapper h1 {
            font-size: 32px;
            font-weight: 900;
            text-align: center;
            letter-spacing: -1px;
            margin-bottom: 10px;
        }

        .input-box {
            position: relative;
            width: 100%;
            height: 55px;
            margin: 25px 0;
        }

        .input-box input {
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, .1);
            outline: none;
            border-radius: 16px;
            font-size: 16px;
            color: #fff;
            padding: 0 45px 0 20px;
            transition: all 0.3s;
        }

        .btn-login {
            width: 100%;
            height: 55px;
            background: #fff;
            border: none;
            outline: none;
            border-radius: 16px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            font-size: 16px;
            color: #0f172a;
            font-weight: 700;
            transition: transform 0.2s;
        }

        .glass-nav {
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 32px;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 9999px;
            font-size: 0.7rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .status-reported { background-color: #dbeafe; color: #1e40af; }
        .status-progress { background-color: #fef3c7; color: #92400e; }
        .status-fixed { background-color: #d1fae5; color: #065f46; }

        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .nav-link.active {
            color: #3b82f6;
            background: rgba(59, 130, 246, 0.15);
            border-radius: 14px;
        }

        #imagePreview img {
            max-height: 200px;
            border-radius: 20px;
            margin-top: 15px;
            object-fit: cover;
            border: 4px solid white;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .animate-float {
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
    </style>
</head>
<body>

    <!-- LOGIN SCREEN -->
    <div id="login-screen" class="fixed inset-0 z-[100] flex flex-col items-center justify-center p-4">
        <div class="mb-8 text-center">
            <div class="bg-blue-600 w-16 h-16 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-2xl">
                <i class='bx bxs-buildings text-3xl text-white'></i>
            </div>
            <h2 class="text-white text-4xl font-black tracking-tighter">Campus<span class="text-blue-500">Fix</span></h2>
        </div>
        <div class="login-wrapper">
            <form id="login-form">
                <h1>Welcome Back</h1>
                <p class="text-center text-white/60 text-sm mb-8">Login to access the dashboard</p>
                <div class="input-box">
                    <input type="text" placeholder="Username" required>
                    <i class='bx bxs-user'></i>
                </div>
                <div class="input-box">
                    <input type="password" placeholder="Password" required>
                    <i class='bx bxs-lock-alt' ></i>
                </div>
                <button type="submit" class="btn-login">Sign In</button>
            </form>
        </div>
    </div>

    <!-- MAIN DASHBOARD CONTENT -->
    <div id="dashboard-content" class="hidden">
        <nav class="glass-nav sticky top-0 z-50">
            <div class="max-w-6xl mx-auto px-6">
                <div class="flex justify-between items-center h-20">
                    <div class="flex items-center space-x-3 group cursor-pointer" onclick="switchTab('report')">
                        <div class="bg-blue-600 p-2 rounded-xl group-hover:rotate-12 transition-transform shadow-lg shadow-blue-500/30">
                            <i class='bx bxs-bolt text-white text-2xl'></i>
                        </div>
                        <span class="text-2xl font-black tracking-tighter text-white">Campus<span class="text-blue-500">Fix</span></span>
                    </div>
                    <div class="flex items-center bg-white/5 p-1.5 rounded-2xl space-x-1 border border-white/10">
                        <button onclick="switchTab('report')" class="nav-link active px-5 py-2 text-sm font-bold text-white transition-all duration-200" id="btn-report">Report</button>
                        <button onclick="switchTab('history')" class="nav-link px-5 py-2 text-sm font-bold text-white/60 hover:text-white transition-all duration-200" id="btn-history">History</button>
                        <button onclick="switchTab('admin')" class="nav-link px-5 py-2 text-sm font-bold text-white/60 hover:text-white transition-all duration-200" id="btn-admin">Admin</button>
                    </div>
                </div>
            </div>
        </nav>

        <main class="max-w-4xl mx-auto px-4 py-12">
            
            <div id="toast" class="hidden fixed bottom-10 left-1/2 -translate-x-1/2 bg-white text-slate-900 px-8 py-4 rounded-3xl shadow-2xl flex items-center space-x-3 transition-all duration-500 z-[100] border border-blue-100">
                <i id="toastIcon" class='bx bxs-check-circle text-2xl text-green-500'></i>
                <span id="toastMsg" class="font-bold text-slate-700">Success!</span>
            </div>

            <!-- SECTION 1: REPORT ISSUE -->
            <section id="report" class="tab-content active">
                <div class="glass-card p-8 md:p-12 shadow-2xl relative overflow-hidden">
                    <div class="relative">
                        <div class="mb-10">
                            <h2 class="text-4xl font-black text-slate-900 mb-3 tracking-tight">Submit Report</h2>
                            <p class="text-slate-500 font-medium">Describe the issue and our team will handle it shortly.</p>
                        </div>
                        
                        <form id="complaintForm" class="space-y-8">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div>
                                    <label class="block text-xs font-black text-slate-400 uppercase tracking-widest mb-3 ml-1">Category</label>
                                    <select id="category" required class="w-full px-6 py-4 rounded-2xl border-2 border-slate-100 focus:border-blue-500 focus:ring-4 focus:ring-blue-500/5 outline-none bg-slate-50 transition-all font-bold text-slate-700 appearance-none">
                                        <option value="">Choose category...</option>
                                        <option value="Washroom">üöΩ Washroom</option>
                                        <option value="Electricity / Lights">üí° Electricity</option>
                                        <option value="Wi-Fi">üì∂ Wi-Fi</option>
                                        <option value="Classroom / Furniture">ü™ë Classroom</option>
                                        <option value="Other">üõ†Ô∏è Other</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-xs font-black text-slate-400 uppercase tracking-widest mb-3 ml-1">Urgency</label>
                                    <select id="urgency" class="w-full px-6 py-4 rounded-2xl border-2 border-slate-100 focus:border-blue-500 focus:ring-4 focus:ring-blue-500/5 outline-none bg-slate-50 transition-all font-bold text-slate-700 appearance-none">
                                        <option value="Low">üü¢ Low Priority</option>
                                        <option value="Medium" selected>üü° Medium Priority</option>
                                        <option value="High">üî¥ High Priority</option>
                                    </select>
                                </div>
                            </div>
                            <div>
                                <label class="block text-xs font-black text-slate-400 uppercase tracking-widest mb-3 ml-1">Description</label>
                                <textarea id="description" rows="4" required class="w-full px-6 py-4 rounded-2xl border-2 border-slate-100 focus:border-blue-500 focus:ring-4 focus:ring-blue-500/5 outline-none bg-slate-50 transition-all font-bold text-slate-700" placeholder="Where is it and what's wrong?"></textarea>
                            </div>
                            <div>
                                <label class="block text-xs font-black text-slate-400 uppercase tracking-widest mb-3 ml-1">Evidence Photo</label>
                                <div class="group flex justify-center p-12 border-4 border-slate-100 border-dashed rounded-3xl hover:border-blue-400 hover:bg-blue-50 transition-all cursor-pointer text-center" onclick="document.getElementById('photoInput').click()">
                                    <div>
                                        <i class='bx bx-cloud-upload text-5xl text-slate-300 group-hover:text-blue-500 transition-colors mb-3'></i>
                                        <p class="text-slate-400 font-bold">Tap to upload proof</p>
                                    </div>
                                    <input id="photoInput" type="file" class="hidden" accept="image/*" onchange="previewImage(event)">
                                </div>
                                <div id="imagePreview" class="flex justify-center"></div>
                            </div>
                            <button type="submit" class="w-full bg-slate-900 hover:bg-blue-600 text-white font-black text-xl py-6 rounded-2xl shadow-xl transition-all transform hover:-translate-y-1">
                                Send Report
                            </button>
                        </form>
                    </div>
                </div>
            </section>

            <!-- SECTION 2: HISTORY -->
            <section id="history" class="tab-content">
                <div id="complaintList" class="space-y-6"></div>
            </section>

            <!-- SECTION 3: ADMIN -->
            <section id="admin" class="tab-content">
                <div class="glass-card overflow-hidden shadow-2xl">
                    <div class="bg-slate-900 px-8 py-6">
                        <h2 class="text-white font-black uppercase tracking-widest text-sm">System Administration</h2>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-slate-50 border-b border-slate-100 text-slate-400 text-[10px] font-black uppercase tracking-widest">
                                <tr>
                                    <th class="px-8 py-4">ID</th>
                                    <th class="px-8 py-4">Category</th>
                                    <th class="px-8 py-4">Status</th>
                                    <th class="px-8 py-4">Update</th>
                                    <th class="px-8 py-4">Action</th>
                                </tr>
                            </thead>
                            <tbody id="adminTableBody" class="divide-y divide-slate-50"></tbody>
                        </table>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- MODALS SECTION -->

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="hidden fixed inset-0 bg-slate-900/80 backdrop-blur-md z-[200] flex items-center justify-center p-4">
        <div class="bg-white rounded-[40px] w-full max-w-sm p-10 shadow-2xl text-center">
            <div class="w-20 h-20 bg-red-100 text-red-600 rounded-full flex items-center justify-center mx-auto mb-6">
                <i class='bx bx-trash text-4xl'></i>
            </div>
            <h3 class="text-2xl font-black text-slate-900 mb-2">Delete Task?</h3>
            <p class="text-slate-500 font-medium mb-8 text-sm leading-relaxed">This action will remove the record from both Admin and History. This cannot be undone.</p>
            <div class="flex flex-col space-y-3">
                <button onclick="executeDelete()" class="w-full py-4 bg-red-600 text-white font-black rounded-2xl shadow-lg hover:bg-red-700 transition-all">Yes, Delete Permanently</button>
                <button onclick="closeDeleteModal()" class="w-full py-4 bg-slate-100 text-slate-600 font-bold rounded-2xl hover:bg-slate-200 transition-all">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Feedback Modal -->
    <div id="feedbackModal" class="hidden fixed inset-0 bg-slate-900/80 backdrop-blur-md z-[200] flex items-center justify-center p-4">
        <div class="bg-white rounded-[40px] w-full max-w-md p-10 shadow-2xl">
            <h3 class="text-3xl font-black text-slate-900 mb-2">Issue Fixed?</h3>
            <p class="text-slate-500 font-medium mb-8">Please rate our work to help us improve.</p>
            <div class="flex justify-center space-x-4 mb-10">
                <button onclick="setRating(1)" class="rating-star text-4xl grayscale hover:grayscale-0 transition-all">‚≠ê</button>
                <button onclick="setRating(2)" class="rating-star text-4xl grayscale hover:grayscale-0 transition-all">‚≠ê</button>
                <button onclick="setRating(3)" class="rating-star text-4xl grayscale hover:grayscale-0 transition-all">‚≠ê</button>
                <button onclick="setRating(4)" class="rating-star text-4xl grayscale hover:grayscale-0 transition-all">‚≠ê</button>
                <button onclick="setRating(5)" class="rating-star text-4xl grayscale hover:grayscale-0 transition-all">‚≠ê</button>
            </div>
            <button onclick="submitFeedback()" class="w-full py-5 bg-blue-600 text-white font-black rounded-2xl shadow-lg shadow-blue-200 hover:bg-blue-700 transition-all">Done</button>
        </div>
    </div>

    <script>
        let complaints = JSON.parse(localStorage.getItem('campus_complaints')) || [];
        let currentRating = 0;
        let activeFeedbackId = null;
        let activeDeleteId = null;

        document.getElementById('login-form').addEventListener('submit', function(e) {
            e.preventDefault();
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('dashboard-content').classList.remove('hidden');
            showToast("Authenticated successfully!", "success");
            renderHistory();
        });

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active'));
            
            document.getElementById(tabId).classList.add('active');
            const activeBtn = document.getElementById('btn-' + tabId);
            activeBtn.classList.add('active');
            
            if(tabId === 'history') renderHistory();
            if(tabId === 'admin') renderAdmin();
        }

        function previewImage(event) {
            const preview = document.getElementById('imagePreview');
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = e => preview.innerHTML = `<img src="${e.target.result}" class="animate-float">`;
                reader.readAsDataURL(file);
            }
        }

        document.getElementById('complaintForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const newComp = {
                id: 'CFX-' + Math.floor(1000 + Math.random() * 9000),
                category: document.getElementById('category').value,
                description: document.getElementById('description').value,
                urgency: document.getElementById('urgency').value,
                date: new Date().toLocaleDateString(),
                status: 'Reported',
                image: document.querySelector('#imagePreview img')?.src || null,
                feedback: null
            };
            complaints.unshift(newComp);
            localStorage.setItem('campus_complaints', JSON.stringify(complaints));
            showToast("Report submitted!", "success");
            this.reset();
            document.getElementById('imagePreview').innerHTML = '';
            setTimeout(() => switchTab('history'), 800);
        });

        // DELETE MODAL LOGIC
        function openDeleteModal(id) {
            activeDeleteId = id;
            document.getElementById('deleteModal').classList.remove('hidden');
        }

        function closeDeleteModal() {
            activeDeleteId = null;
            document.getElementById('deleteModal').classList.add('hidden');
        }

        function executeDelete() {
            if(!activeDeleteId) return;
            
            // 1. Remove from local array
            complaints = complaints.filter(c => c.id !== activeDeleteId);
            
            // 2. Save to localStorage
            localStorage.setItem('campus_complaints', JSON.stringify(complaints));
            
            // 3. Close modal
            closeDeleteModal();
            
            // 4. Update both views
            renderHistory();
            renderAdmin();
            
            // 5. User feedback
            showToast("Task deleted successfully", "delete");
        }

        function renderHistory() {
            const list = document.getElementById('complaintList');
            if (complaints.length === 0) {
                list.innerHTML = `<div class="glass-card p-12 text-center text-slate-400 font-bold">No history available yet.</div>`;
                return;
            }
            list.innerHTML = complaints.map(c => `
                <div class="glass-card p-8 flex flex-col md:flex-row gap-8 relative hover:scale-[1.01] transition-transform">
                    
                    <!-- USER DELETE ICON: ONLY IF FIXED -->
                    ${c.status === 'Fixed' ? `
                    <button onclick="openDeleteModal('${c.id}')" title="Delete record" class="absolute top-6 right-6 p-2 text-slate-300 hover:text-red-500 hover:bg-red-50 rounded-xl transition-all">
                        <i class='bx bx-trash text-2xl'></i>
                    </button>` : ''}

                    <div class="w-full md:w-32 h-32 bg-slate-50 rounded-2xl flex-shrink-0 overflow-hidden border border-slate-100">
                        ${c.image ? `<img src="${c.image}" class="w-full h-full object-cover">` : `<div class="h-full flex items-center justify-center"><i class='bx bx-image text-4xl text-slate-200'></i></div>`}
                    </div>
                    <div class="flex-grow">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <span class="text-[10px] font-black text-blue-500 uppercase tracking-widest">${c.id}</span>
                                <h3 class="text-xl font-black text-slate-900">${c.category}</h3>
                            </div>
                            <span class="status-badge ${c.status === 'Reported' ? 'status-reported' : c.status === 'In Progress' ? 'status-progress' : 'status-fixed'}">${c.status}</span>
                        </div>
                        <p class="text-slate-500 text-sm font-medium mb-6 leading-relaxed">${c.description}</p>
                        <div class="flex items-center space-x-4">
                            <span class="text-[11px] font-black text-slate-400 uppercase tracking-tighter bg-slate-100 px-3 py-1 rounded-full">${c.urgency} Priority</span>
                            ${c.status === 'Fixed' && !c.feedback ? `<button onclick="openFeedback('${c.id}')" class="text-xs font-black text-blue-600 underline">Rate Fix</button>` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderAdmin() {
            const body = document.getElementById('adminTableBody');
            if (complaints.length === 0) {
                body.innerHTML = `<tr><td colspan="5" class="px-8 py-12 text-center text-slate-400 font-bold">System database is empty.</td></tr>`;
                return;
            }
            body.innerHTML = complaints.map(c => `
                <tr class="hover:bg-slate-50/50 transition-colors">
                    <td class="px-8 py-6 font-mono text-[11px] text-slate-400 font-bold">${c.id}</td>
                    <td class="px-8 py-6 font-bold text-slate-700">${c.category}</td>
                    <td class="px-8 py-6 font-bold text-slate-500 text-xs">${c.status}</td>
                    <td class="px-8 py-6">
                        <select onchange="updateStatus('${c.id}', this.value)" class="text-xs font-black border-2 border-slate-100 rounded-xl px-4 py-2 bg-white outline-none focus:border-blue-500">
                            <option value="Reported" ${c.status === 'Reported' ? 'selected' : ''}>Reported</option>
                            <option value="In Progress" ${c.status === 'In Progress' ? 'selected' : ''}>In Progress</option>
                            <option value="Fixed" ${c.status === 'Fixed' ? 'selected' : ''}>Fixed</option>
                        </select>
                    </td>
                    <td class="px-8 py-6">
                        <button onclick="openDeleteModal('${c.id}')" class="text-red-500 hover:text-red-700 font-black text-xs uppercase tracking-widest bg-red-50 hover:bg-red-100 px-4 py-2 rounded-xl transition-all">
                            Delete Task
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function updateStatus(id, newStatus) {
            const idx = complaints.findIndex(c => c.id === id);
            if(idx !== -1) {
                complaints[idx].status = newStatus;
                localStorage.setItem('campus_complaints', JSON.stringify(complaints));
                showToast("Status updated to " + newStatus, "success");
                if(newStatus === 'Fixed') {
                    renderHistory();
                    setTimeout(() => switchTab('history'), 500);
                }
            }
        }

        function showToast(msg, type = "success") {
            const t = document.getElementById('toast');
            const icon = document.getElementById('toastIcon');
            document.getElementById('toastMsg').innerText = msg;
            
            if(type === 'delete') {
                icon.className = 'bx bxs-trash text-2xl text-red-500';
            } else {
                icon.className = 'bx bxs-check-circle text-2xl text-green-500';
            }

            t.classList.remove('hidden');
            setTimeout(() => t.classList.add('hidden'), 3000);
        }

        function openFeedback(id) {
            activeFeedbackId = id;
            document.getElementById('feedbackModal').classList.remove('hidden');
            setRating(0);
        }

        function setRating(v) {
            currentRating = v;
            document.querySelectorAll('.rating-star').forEach((s, i) => s.classList.toggle('grayscale', i >= v));
        }

        function submitFeedback() {
            if(currentRating === 0) return showToast("Select stars!", "error");
            const idx = complaints.findIndex(c => c.id === activeFeedbackId);
            if(idx !== -1) {
                complaints[idx].feedback = { rating: currentRating };
                localStorage.setItem('campus_complaints', JSON.stringify(complaints));
                document.getElementById('feedbackModal').classList.add('hidden');
                renderHistory();
                showToast("Rating saved!", "success");
            }
        }
    </script>
</body>
</html>